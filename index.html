<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ScootWay - Itinéraire</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    .container {
        padding: 30px;
    }

    label {
      display: block; 
      margin-top: 1rem; 
      margin-bottom: .3rem;
      color: #bbb;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    input {
      width: 100%; 
      max-width: 600px;
      padding: .6rem .8rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      box-sizing: border-box;
      display: block;
      margin: 0 auto 1rem auto;
    }

    button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #ff6600;
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s ease;
        max-width: 600px;
        display: block;
        margin: 1rem auto;
    }

    button:hover {
      background: #ff8533;
    }

    #map {
        width: 100%;
        max-width: 600px;
        height: 400px;
        margin: 20px auto 0 auto;
        border-radius: 15px;
    }

    #alert {
      max-width: 600px;
      margin: 0 auto;
      color: #ff5252;
      font-weight: bold;
      min-height: 1.5em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ScootWay - Tracer un itinéraire</h1>

    <label for="start">Départ :</label>
    <input id="start" type="text" placeholder="Adresse de départ ou utilisez la géolocalisation" />

    <label for="end">Arrivée :</label>
    <input id="end" type="text" placeholder="Ex : 140 rue Falguière, La Ville-du-Bois" value="140 rue Falguière, La Ville-du-Bois" />

    <button id="routeBtn">Tracer l’itinéraire</button>

    <div id="alert"></div>
    <div id="map"></div>
  </div>

  <script>
    let map, directionsService, directionsRenderer;
    let startInput, endInput, alertBox;

    function initMap() {
      // Initialisation carte centrée sur La Ville-du-Bois par défaut
      const defaultPos = { lat: 48.6283, lng: 2.2663 }; // approximatif

      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 13,
        center: defaultPos,
      });

      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

      startInput = document.getElementById("start");
      endInput = document.getElementById("end");
      alertBox = document.getElementById("alert");

      // Autocomplete Google Places
      const options = { types: ["address"] };
      new google.maps.places.Autocomplete(startInput, options);
      new google.maps.places.Autocomplete(endInput, options);

      document.getElementById("routeBtn").addEventListener("click", () => {
        calculateAndDisplayRoute();
      });

      // Optionnel : géolocalisation automatique pour départ
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };
            startInput.value = "Ma position actuelle";
            // On met un marker temporaire
            new google.maps.Marker({
              position: pos,
              map: map,
              title: "Votre position",
            });
            map.setCenter(pos);
          },
          () => {
            console.log("Géolocalisation refusée ou indisponible");
          }
        );
      }
    }

    function calculateAndDisplayRoute() {
      alertBox.textContent = "";
      let start = startInput.value.trim();
      let end = endInput.value.trim();

      if (!start) {
        alertBox.textContent = "Veuillez saisir une adresse de départ.";
        return;
      }
      if (!end) {
        alertBox.textContent = "Veuillez saisir une adresse d'arrivée.";
        return;
      }

      // Si départ = "Ma position actuelle", on récupère la géolocalisation réelle
      if (start.toLowerCase() === "ma position actuelle" && navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };
            requestRoute(pos, end);
          },
          () => {
            alertBox.textContent = "Impossible de récupérer votre position.";
          }
        );
      } else {
        requestRoute(start, end);
      }
    }

    function requestRoute(start, end) {
      directionsService.route(
        {
          origin: start,
          destination: end,
          travelMode: google.maps.TravelMode.DRIVING, // on peut changer plus tard
          avoidTolls: true,
          avoidHighways: true, // important pour éviter autoroutes interdites 50cc
        },
        (response, status) => {
          if (status === "OK") {
            directionsRenderer.setDirections(response);
            alertBox.textContent = "";
          } else {
            alertBox.textContent = "Itinéraire introuvable : " + status;
          }
        }
      );
    }
  </script>

  <!-- Charger l'API Google Maps avec Places pour autocomplétion -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=TA_CLE_API_ICI&libraries=places&callback=initMap"
    async
    defer
  ></script>
</body>
</html>
